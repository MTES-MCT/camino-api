<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/api/resolvers/titres.js | camino-api</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Camino api"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="camino-api"><meta property="twitter:description" content="Camino api"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/MTES-MCT/camino-api"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api">api</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-schema">schema</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-resolvers">api/resolvers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreFormat">titreFormat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-geojsonFeatureCollectionPoints">geojsonFeatureCollectionPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-geojsonFeatureMultiPolygon">geojsonFeatureMultiPolygon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-geojsonMultiPolygonCoordinates">geojsonMultiPolygonCoordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-permissionsCheck">permissionsCheck</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-entreprise">entreprise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-entreprises">entreprises</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-metas">metas</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-permission">permission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-permissions">permissions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-substance">substance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-substances">substances</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreTravauxRapportModifier">titreTravauxRapportModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titre">titre</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreAjouter">titreAjouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapeModifier">titreEtapeModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreModifier">titreModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreSupprimer">titreSupprimer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titres">titres</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateur">utilisateur</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurAjoutEmailEnvoyer">utilisateurAjoutEmailEnvoyer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurAjouter">utilisateurAjouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurConnecter">utilisateurConnecter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurIdentifier">utilisateurIdentifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurModifier">utilisateurModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurMotDePasseEmailEnvoyer">utilisateurMotDePasseEmailEnvoyer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurMotDePasseInitialiser">utilisateurMotDePasseInitialiser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurMotDePasseModifier">utilisateurMotDePasseModifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurSupprimer">utilisateurSupprimer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurs">utilisateurs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-version">version</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-restrictedDomaineIds">restrictedDomaineIds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-restrictedStatutIds">restrictedStatutIds</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#config">config</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-debug">debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-port">port</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-url">url</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-knexConfig">knexConfig</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#database">database</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-knex">knex</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#database-models">database/models</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/administrations.js~Administrations.html">Administrations</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/demarches-statuts.js~DemarchesStatuts.html">DemarchesStatuts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/demarches-types.js~DemarchesTypes.html">DemarchesTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/domaines.js~Domaines.html">Domaines</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/emprises.js~Emprises.html">Emprises</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/entreprises.js~Entreprises.html">Entreprises</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/etapes-statuts.js~EtapesStatuts.html">EtapesStatuts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/etapes-types.js~EtapesTypes.html">EtapesTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/permissions.js~Permissions.html">Permissions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/phases-statuts.js~PhasesStatuts.html">PhasesStatuts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/statuts.js~Statuts.html">Statuts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/substances-legales-codes.js~SubstancesLegalesCodes.html">SubstancesLegalesCodes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/substances-legales.js~SubstancesLegales.html">SubstancesLegales</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/substances.js~Substances.html">Substances</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-administrations.js~TitresAdministrations.html">TitresAdministrations</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-amodiataires.js~TitresAmodiataires.html">TitresAmodiataires</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-demarches.js~TitresDemarches.html">TitresDemarches</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-documents.js~TitresDocuments.html">TitresDocuments</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-emprises.js~TitresEmprises.html">TitresEmprises</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-erreurs.js~TitresErreurs.html">TitresErreurs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-etapes.js~TitresEtapes.html">TitresEtapes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-phases.js~TitresPhases.html">TitresPhases</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-points-references.js~TitresPointsReferences.html">TitresPointsReferences</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-points.js~TitresPoints.html">TitresPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-substances.js~TitresSubstances.html">TitresSubstances</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-titulaires.js~TitresTitulaires.html">TitresTitulaires</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres-travaux-rapports.js~TitresTravauxRapports.html">TitresTravauxRapports</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/titres.js~Titres.html">Titres</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/types.js~Types.html">Types</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/database/models/utilisateurs.js~Utilisateurs.html">Utilisateurs</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#database-queries">database/queries</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-entrepriseGet">entrepriseGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-entreprisesGet">entreprisesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-demarchesTypesGet">demarchesTypesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-domainesGet">domainesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-statutsGet">statutsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typesGet">typesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-permissionGet">permissionGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-permissionsGet">permissionsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-substanceGet">substanceGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-substancesGet">substancesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheGet">titreDemarcheGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheOrdreUpdate">titreDemarcheOrdreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheStatutIdUpdate">titreDemarcheStatutIdUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresDemarchesGet">titresDemarchesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapeGet">titreEtapeGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapeUpdate">titreEtapeUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapeUpsert">titreEtapeUpsert</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresEtapesGet">titresEtapesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePhaseDelete">titrePhaseDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePhaseUpdate">titrePhaseUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresPhasesGet">titresPhasesGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePointUpdate">titrePointUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresPointsGet">titresPointsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreTravauxRapportUpdate">titreTravauxRapportUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresTravauxRapportGet">titresTravauxRapportGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresTravauxRapportsGet">titresTravauxRapportsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreAdd">titreAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreGet">titreGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePropsUpdate">titrePropsUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreRemove">titreRemove</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreUpdate">titreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresGet">titresGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurAdd">utilisateurAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurByEmailGet">utilisateurByEmailGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurGet">utilisateurGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurRemove">utilisateurRemove</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateurUpdate">utilisateurUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-utilisateursGet">utilisateursGet</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tasks">tasks</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheStatutIdUpdate">titreDemarcheStatutIdUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarchesOrdreUpdate">titreDemarchesOrdreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapesOrdreUpdate">titreEtapesOrdreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePhaseDelete">titrePhaseDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePhaseUpdate">titrePhaseUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePropsUpdate">titrePropsUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreStatutIdUpdate">titreStatutIdUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-calculatedProps">calculatedProps</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-titreDemarche">titreDemarche</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tasks--utils">tasks/_utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDateFinFind">titreDateFinFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheDateFinAndDureeFind">titreDemarcheDateFinAndDureeFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheOrdreFind">titreDemarcheOrdreFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarchePhasesFilter">titreDemarchePhasesFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarcheStatutIdFind">titreDemarcheStatutIdFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreDemarchesAscSort">titreDemarchesAscSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapesAscSort">titreEtapesAscSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreEtapesSortDesc">titreEtapesSortDesc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePhasesFind">titrePhasesFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titrePropEtapeIdFind">titrePropEtapeIdFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreStatutIdFind">titreStatutIdFind</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tasks-daily">tasks/daily</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresDemarchesOrdreUpdate">titresDemarchesOrdreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresDemarchesUpdate">titresDemarchesUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresEtapesOrdreUpdate">titresEtapesOrdreUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresPhasesUpdate">titresPhasesUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresPropsEtapeIdsUpdate">titresPropsEtapeIdsUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titresStatutIdsUpdate">titresStatutIdsUpdate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tasks-etape-update">tasks/etape-update</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-run">run</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools">tools</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dupFind">dupFind</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dupRemove">dupRemove</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-export">tools/export</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreTravauxRapportRowAdd">titreTravauxRapportRowAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-titreTravauxRapportRowUpdate">titreTravauxRapportRowUpdate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-definitions">definitions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-export--utils">tools/export/_utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dbProcess">dbProcess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cellSet">cellSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cellsGet">cellsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-gssGetInfo">gssGetInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-gssUseServiceAccountAuth">gssUseServiceAccountAuth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rowAdd">rowAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rowDelete">rowDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rowsGet">rowsGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-worksheetAdd">worksheetAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-worksheetRemove">worksheetRemove</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-jsonToSpreadsheet">jsonToSpreadsheet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rowFormat">rowFormat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spreadsheetRowAdd">spreadsheetRowAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spreadsheetRowUpdate">spreadsheetRowUpdate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-export-tables">tools/export/tables</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-tables">tables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-tables">tables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-utilisateursTables">utilisateursTables</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-import">tools/import</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-spreadSheets">spreadSheets</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-import--utils">tools/import/_utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spreadsheetToJson">spreadsheetToJson</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fileCreate">fileCreate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-filePathCreate">filePathCreate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools-mailer">tools/mailer</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-emailsBatch">emailsBatch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mailer">mailer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/api/resolvers/titres.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import permissionsCheck from &apos;./_permissions-check&apos;
import { titreFormat } from &apos;./_format&apos;
import { restrictedDomaineIds, restrictedStatutIds } from &apos;./_restrictions&apos;

import {
  titreGet,
  titresGet,
  titreAdd,
  titreRemove,
  titreUpdate
} from &apos;../../database/queries/titres&apos;

import { domainesGet, statutsGet } from &apos;../../database/queries/metas&apos;

import { titreEtapeUpsert } from &apos;../../database/queries/titres-etapes&apos;

import { utilisateurGet } from &apos;../../database/queries/utilisateurs&apos;

import { dupRemove, dupFind } from &apos;../../tools/index&apos;

import titreEtapeUpdateTasks from &apos;../../tasks/etape-update/index&apos;

const titre = async ({ id }, context, info) =&gt; {
  const titre = await titreGet(id)

  const userEntreprisePermissions = async (userId, titreEntrepriseIds) =&gt; {
    const utilisateur = await utilisateurGet(userId)
    const entrepriseId = utilisateur.entreprise &amp;&amp; utilisateur.entreprise.id
    return titreEntrepriseIds.some(id =&gt; id === entrepriseId)
  }

  return (!restrictedDomaineIds.includes(titre.domaineId) &amp;&amp;
    !restrictedStatutIds.includes(titre.statutId)) ||
    (context.user &amp;&amp;
      (permissionsCheck(context.user, [&apos;admin&apos;, &apos;super&apos;]) ||
        (await userEntreprisePermissions(context.user.id, [
          ...titre.titulaires.map(t =&gt; t.id),
          ...titre.amodiataires.map(t =&gt; t.id)
        ]))))
    ? titre &amp;&amp; titreFormat(titre)
    : null
}

const titres = async (
  { typeIds, domaineIds, statutIds, substances, noms, entreprises, references },
  context,
  info
) =&gt; {
  const domaineIdsRestrict = async domaineIds =&gt; {
    if (!domaineIds) {
      const domaines = await domainesGet()
      domaineIds = domaines.map(domaine =&gt; domaine.id)
    }

    return domaineIds.filter(id =&gt; !restrictedDomaineIds.includes(id))
  }

  const statutIdsRestrict = async statutIds =&gt; {
    if (!statutIds) {
      const statuts = await statutsGet()
      statutIds = statuts.map(statut =&gt; statut.id)
    }

    return statutIds.filter(id =&gt; !restrictedStatutIds.includes(id))
  }

  const userEntrepriseTitresFind = async (
    userId,
    {
      typeIds,
      domaineIds,
      statutIds,
      substances,
      noms,
      entreprises,
      references
    }
  ) =&gt; {
    const utilisateur = await utilisateurGet(userId)
    const entrepriseId =
      utilisateur &amp;&amp; utilisateur.entreprise &amp;&amp; utilisateur.entreprise.id

    if (entrepriseId) {
      // si le filtre `entreprise est renseign&#xE9;,
      // on en peut pas savoir si `entreprises` renvoie la m&#xEA;me liste que `[entrepriseId]`
      // donc on fait une requ&#xEA;te pour chaque
      // et on ne garde que les &#xE9;l&#xE9;ments pr&#xE9;sent dans les deux
      const entrepriseTitres =
        entreprises &amp;&amp;
        (await titresGet({
          typeIds,
          domaineIds,
          statutIds,
          substances,
          noms,
          entreprises,
          references
        }))

      const userEntrepriseTitres = await titresGet({
        typeIds,
        domaineIds,
        statutIds,
        substances,
        noms,
        entreprises: [entrepriseId],
        references
      })

      return entreprises
        ? dupFind(&apos;id&apos;, entrepriseTitres, userEntrepriseTitres)
        : userEntrepriseTitres
    }

    return []
  }

  const userEntrepriseTitres =
    context.user &amp;&amp; permissionsCheck(context.user, [&apos;entreprise&apos;])
      ? await userEntrepriseTitresFind(context.user.id, {
          typeIds,
          domaineIds,
          statutIds,
          substances,
          noms,
          entreprises,
          references
        })
      : []

  const titres = await titresGet({
    typeIds,
    domaineIds:
      context.user &amp;&amp; permissionsCheck(context.user, [&apos;admin&apos;, &apos;super&apos;])
        ? domaineIds
        : await domaineIdsRestrict(domaineIds),
    statutIds:
      context.user &amp;&amp; permissionsCheck(context.user, [&apos;admin&apos;, &apos;super&apos;])
        ? statutIds
        : await statutIdsRestrict(statutIds),
    substances,
    noms,
    entreprises,
    references
  })

  const titresList = dupRemove(&apos;id&apos;, titres, userEntrepriseTitres)

  return titresList.map(titre =&gt; titre &amp;&amp; titreFormat(titre))
}

const titreAjouter = async ({ titre }, context, info) =&gt; {
  const errors = []

  if (!permissionsCheck(context.user, [&apos;super&apos;, &apos;admin&apos;])) {
    errors.push(&apos;op&#xE9;ration impossible&apos;)
  }

  if (!errors.length) {
    return titreAdd(titre)
  } else {
    throw new Error(errors.join(&apos;, &apos;))
  }
}

const titreSupprimer = async ({ id }, context, info) =&gt; {
  const errors = []

  if (!permissionsCheck(context.user, [&apos;super&apos;, &apos;admin&apos;])) {
    errors.push(&apos;op&#xE9;ration impossible&apos;)
  }

  if (!errors.length) {
    return titreRemove(id)
  } else {
    throw new Error(errors.join(&apos;, &apos;))
  }
}

const titreModifier = async ({ titre }, context, info) =&gt; {
  const errors = []

  if (!permissionsCheck(context.user, [&apos;super&apos;, &apos;admin&apos;])) {
    errors.push(&apos;op&#xE9;ration impossible&apos;)
  }

  if (!errors.length) {
    return titreUpdate(titre)
  } else {
    throw new Error(errors.join(&apos;, &apos;))
  }
}

const titreEtapeModifier = async ({ etape }, context, info) =&gt; {
  const errors = []

  if (!permissionsCheck(context.user, [&apos;super&apos;, &apos;admin&apos;])) {
    errors.push(&apos;op&#xE9;ration impossible&apos;)
  }

  if (!errors.length) {
    // si l&apos;id de l&apos;&#xE9;tape ne correspond pas &#xE0; son type
    const etapeTypeIdSlug = etape.id.slice(-5, -2)
    const etapeTypeId = etape.type.id
    console.log(etapeTypeIdSlug, etapeTypeId)
    if (etapeTypeIdSlug !== etapeTypeId) {
      // mettre &#xE0; jour l&apos;id de l&apos;&#xE9;tape et les ids de ses enfants
      const etapeIdUpdated = etapeIdUpdate(etape)
      console.log(etapeIdUpdated)
      // supprimer l&apos;ancienne &#xE9;tape et ses enfants
      // ajouter la nouvelle &#xE9;tape et ses enfants
    }

    const res = await titreEtapeUpsert(etape)
    await titreEtapeUpdateTasks(etape)

    return res
  } else {
    throw new Error(errors.join(&apos;, &apos;))
  }
}

const etapeIdUpdate = etape =&gt; {
  const props = [
    &apos;substances&apos;,
    &apos;points&apos;,
    &apos;titulaires&apos;,
    &apos;amodiataires&apos;,
    &apos;administrations&apos;,
    &apos;documents&apos;,
    &apos;communes&apos;,
    &apos;emprises&apos;
  ]

  return etape
}

export {
  titre,
  titres,
  titreAjouter,
  titreSupprimer,
  titreModifier,
  titreEtapeModifier
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
